checkout:
  post:
    - git submodule sync
    - git submodule update --init
    - bash -c '[[ $(grep -cE "^ " Makefile.am) -eq 0 ]]'

machine:
  environment:
    PATH: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
    LD_LIBRARY_PATH: /usr/local/lib:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu:/lib32:/usr/lib32

dependencies:
  override:
    - sudo apt-get update
    - scripts/dependencies.sh
    - (rc=0; for f in *.json; do python -c "import json; json.load(open('$f'))" || rc=$?; done; exit $rc;)
    - (rc=0; for f in lua/*.lua; do lua $f || rc=$?; done; exit $rc;)
    - (rc=0; for f in locales/*.json; do python -c "import json; json.load(open('$f'))" || rc=$?; done; exit $rc;)

test:
  override:
    - ./autogen.sh
    - ./configure CPPFLAGS="-DBOOST_SPIRIT_THREADSAFE -DBOOST_NO_CXX11_SCOPED_ENUMS" --enable-coverage --enable-python-bindings
    - make test -j$(nproc)
    - sudo make install

general:
  artifacts:
    - config.log
    - test/*.log
    - Makefile
