machine:
  pre:
    - sudo add-apt-repository -y ppa:boost-latest/ppa
    - sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test
    - sudo rm /etc/apt/sources.list.d/google-chrome.list #workaround for duplicate sources on ubuntu 12.04 circlci machine
    - sudo apt-get update

checkout:
  post:
    - git submodule sync
    - git submodule update --init
    - git clone --depth=1 --recurse-submodules --single-branch --branch=master https://github.com/valhalla/midgard.git deps/midgard

dependencies:
  override:
    - sudo apt-get remove --purge -y libboost*
    - sudo apt-get install -y autoconf automake libtool make gcc-4.8 g++-4.8 libboost1.54-dev lcov
    - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.8 90
    #valhalla dependencies
    - cd deps; for dep in midgard; do cd $dep; ./autogen.sh && ./configure && sudo make install; find /usr/local/include; cd ../; done

test:
  pre:
    - ./autogen.sh && ./configure --enable-coverage --with-valhalla-midgard=/usr/local
  override:
    - cat config.log
    - make test -j2
  post:
    - sudo make install
